<div class="appointment-container">
  <mat-card class="appointment-card">
    <mat-card-header>
      <mat-card-title>Reservar Turno</mat-card-title>
      <mat-card-subtitle>Complete el formulario para solicitar su turno</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="appointmentForm" (ngSubmit)="onSubmit()" class="appointment-form">
        <!-- Cargando Talleres -->
        <div *ngIf="loadingWorkshops" class="loading-spinner">
          <p>Cargando talleres...</p>
        </div>

        <!-- Selector de Taller -->
        <mat-form-field appearance="outline" class="full-width" *ngIf="!loadingWorkshops">
          <mat-label>Taller</mat-label>
          <mat-select formControlName="place_id" required>
            <mat-option *ngFor="let workshop of workshops" [value]="workshop.id">
              {{ workshop.name }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="isFieldInvalid('place_id')">Seleccione un taller.</mat-error>
        </mat-form-field>

        <!-- Fecha y Hora -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Fecha y Hora</mat-label>
          <input matInput [matDatepicker]="picker" formControlName="appointment_at" required>
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <mat-error *ngIf="isFieldInvalid('appointment_at')">Seleccione una fecha y hora.</mat-error>
        </mat-form-field>

        <!-- Tipo de Servicio -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Tipo de Servicio</mat-label>
          <input matInput formControlName="service_type" placeholder="Ej: Cambio de aceite, revisión general" required>
          <mat-error *ngIf="isFieldInvalid('service_type')">
            Ingrese el tipo de servicio (mín. 2 caracteres).
          </mat-error>
        </mat-form-field>

        <!-- Datos de Contacto -->
        <h3>Datos de Contacto</h3>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nombre</mat-label>
          <input matInput formControlName="contact_name" placeholder="Ingrese su nombre" required>
          <mat-error *ngIf="isFieldInvalid('contact_name')">
            Ingrese su nombre (mín. 2 caracteres).
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Email</mat-label>
          <input matInput formControlName="contact_email" placeholder="nombre@ejemplo.com" type="email" required>
          <mat-error *ngIf="isFieldInvalid('contact_email')">Ingrese un email válido.</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Teléfono</mat-label>
          <input matInput formControlName="contact_phone" placeholder="Ej: 1123456789" required>
          <mat-error *ngIf="isFieldInvalid('contact_phone')">
            Ingrese un teléfono (mín. 6 dígitos).
          </mat-error>
        </mat-form-field>

        <!-- Datos del Vehículo (Opcional) -->
        <h3>Datos del Vehículo (Opcional)</h3>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Marca</mat-label>
          <input matInput formControlName="vehicle_make" placeholder="Ej: Ford, Chevrolet">
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Modelo</mat-label>
          <input matInput formControlName="vehicle_model" placeholder="Ej: Focus, Onix">
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Año</mat-label>
          <input matInput type="number" formControlName="vehicle_year" placeholder="Ej: 2020">
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Patente</mat-label>
          <input matInput formControlName="vehicle_license_plate" placeholder="Ej: ABC123">
        </mat-form-field>

        <!-- Botón de Enviar -->
        <div class="form-actions">
          <button mat-raised-button color="primary" type="submit" [disabled]="appointmentForm.invalid || loadingSubmit">
            <mat-icon *ngIf="loadingSubmit" class="spinner">autorenew</mat-icon>
            {{ loadingSubmit ? 'Enviando...' : 'Reservar Turno' }}
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>